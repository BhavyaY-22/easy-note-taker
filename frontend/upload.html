<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Upload - Easy Note Taker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: Arial, sans-serif; }
    .nav-link { transition: color 150ms ease, background-color 150ms ease; padding: 6px 8px; border-radius: 6px; }
    .nav-link:hover, .nav-link:focus { background-color: rgba(255,255,255,0.06); color: cyan; }
    textarea { width: 100%; }
  </style>
</head>
<body class="bg-gray-900 text-white">
{% include '_navbar.html' %}

  <main class="container mx-auto max-w-3xl px-4 py-12">
    <div id="upload" class="relative isolate overflow-hidden bg-gray-800 p-6 pt-12 pb-12 border border-gray-700 rounded-lg flex items-center justify-center">
      <div class="flex flex-col items-center gap-5 w-full max-w-xl">
          <div class="w-full max-w-md">
            <input type="file" id="audioFile" accept="audio/*" class="border border-gray-200 p-3 rounded w-full bg-white">
            <p id="fileName" class="text-sm text-gray-300 mt-2"></p>
          </div>
          <button onclick="processMeeting()" class="bg-cyan-500 font-semibold hover:bg-cyan-600 text-white px-4 py-2 rounded">Process Meeting</button>
          <p id="status" class="text-sm text-gray-300 mt-2"></p>
      </div>
    </div>

    <section id="results" class="hidden bg-white p-4 rounded shadow mt-6 text-black">
      <h3 class="text-lg font-medium">Transcript</h3>
      <textarea id="transcript" class="w-full h-40 p-2 border rounded" placeholder="Transcript will appear here"></textarea>
      <button onclick="download('transcript')" class="mt-2 bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded">Download Transcript</button>

      <h3 class="text-lg font-medium mt-4">Translated Transcript</h3>
      <textarea id="translated" class="w-full h-32 p-2 border rounded" placeholder="Translated transcript"></textarea>
      <button onclick="download('translated')" class="mt-2 bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded">Download Translation</button>
      <h3 class="text-lg font-medium mt-4">Summary & Action Items</h3>
      <textarea id="summary" class="w-full h-32 p-2 border rounded" placeholder="Summary and action items"></textarea>
      <button onclick="download('summary')" class="mt-2 bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded">Download Summary</button>

      <h3 class="text-lg font-medium mt-4">Speaker-labeled Transcript</h3>
      <textarea id="speaker_transcript" class="w-full h-32 p-2 border rounded" placeholder="Speaker labeled transcript"></textarea>
      <button onclick="download('speaker_transcript')" class="mt-2 bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded">Download Speaker Transcript</button>
    </section>
  </main>
<!-- Foooter -->
<section class="bg-gray-700">
    <div class="max-w-screen-xl px-4 py-12 mx-auto space-y-8 overflow-hidden sm:px-6 lg:px-8">
        <nav class="flex flex-wrap justify-center -mx-5 -my-2">
            <div class="px-5 py-2">
                <a href="/features.html" class="text-base leading-6 text-white hover:text-gray-900">
                    About
                </a>
            </div>
            <div class="px-5 py-2">
                <a href="https://github.com/Bhavyyy/easy-note-taker" class="text-base leading-6 text-white hover:text-gray-900">
                    GitHub
                </a>
            </div>
            <div class="px-5 py-2">
                <a href="/contact.html" class="text-base leading-6 text-white hover:text-gray-900">
                    Contact
                </a>
            </div>
        </nav>
        <div class="flex justify-center mt-8 space-x-6">
            <a href="https://github.com/Bhavyyy/easy-note-taker" class="text-white hover:text-gray-500">
                <span class="sr-only">GitHub</span>
                <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                </svg>
            </a>
        </div>
        <p class="mt-8 text-base leading-6 text-center text-gray-400">
            Â© 2024 EasyNotes, Inc. All rights reserved.
        </p>
    </div>
</section>
  <script>
    async function processMeeting() {
      const fileInput = document.getElementById("audioFile");
      const status = document.getElementById("status");

      if (!fileInput.files.length) {
        alert("Please select an audio file.");
        return;
      }

      status.innerText = "Processing meeting... please wait.";
      document.getElementById("results").classList.add("hidden");

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      try {
        const API_URL = window.location.hostname === "localhost"
  ? "http://localhost:8000/process"
  : "/process";

const response = await fetch(API_URL, {
  method: "POST",
  body: formData
});
        if (!response.ok) throw new Error(`${response.status} ${response.statusText}`);
        const data = await response.json();

        const setIfExists = (id, value) => {
          const el = document.getElementById(id);
          if (el) el.value = value || "";
        };

        setIfExists("transcript", data.transcript);
        setIfExists("translated", data.translated);
        setIfExists("summary", data.summary);
        setIfExists("speaker_transcript", data.speaker_transcript);

        document.getElementById("results").classList.remove("hidden");
        status.innerText = "Processing complete.";
      } catch (err) {
        status.innerText = 'Error: ' + err.message;
      }
    }

    function download(type) {
      const el = document.getElementById(type);
      if (!el || !el.value) { alert('Nothing to download for ' + type); return; }
      const text = el.value;
      const blob = new Blob([text], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${type}.txt`;
      document.body.appendChild(link);
      link.click();
      URL.revokeObjectURL(link.href);
      link.remove();
    }
    const audioFileInput = document.getElementById('audioFile');
    if (audioFileInput) {
      audioFileInput.addEventListener('change', (e) => {
        const f = e.target.files[0];
        const nameEl = document.getElementById('fileName');
        if (nameEl) nameEl.textContent = f ? f.name : '';
      });
    }
  </script>
</body>
</html>